version: 2.1

commands:
  install-bazel:
    steps:
      - run:
          name: Install Bazel
          command: |
            apt install -y bash-completion
            wget https://github.com/bazelbuild/bazel/releases/download/4.2.0/bazel_4.2.0-linux-x86_64.deb
            dpkg -i bazel_4.2.0-linux-x86_64.deb

jobs:
  test:
    docker:
      - image: gcc:9.2.0

    steps:
      - checkout

      - run:
          name: Update APT
          command: |
            apt update

      - install-bazel

      - run:
          name: Execute tests
          command: |
            bazel test //...

workflows:
  test:
    jobs:
      - test