Version 4
SHEET 1 5140 972
WIRE -2688 -592 -2704 -592
WIRE -2688 -576 -2688 -592
WIRE -2688 -560 -2704 -560
WIRE -2688 -528 -2688 -544
WIRE -2688 -528 -2704 -528
WIRE -2624 -464 -2720 -464
WIRE -3024 -336 -3056 -336
WIRE -2640 -336 -2704 -336
WIRE -2592 -336 -2640 -336
WIRE -2112 -336 -2160 -336
WIRE 2176 -304 2096 -304
WIRE 2096 -288 2096 -304
WIRE 240 -192 -32 -192
WIRE 512 -192 240 -192
WIRE 784 -192 512 -192
WIRE 240 -160 240 -192
WIRE 352 -160 240 -160
WIRE 512 -160 512 -192
WIRE 624 -160 512 -160
WIRE 784 -160 784 -192
WIRE 896 -160 784 -160
WIRE 240 -128 240 -160
WIRE 352 -128 352 -160
WIRE 512 -128 512 -160
WIRE 624 -128 624 -160
WIRE 784 -128 784 -160
WIRE 896 -128 896 -160
WIRE -1328 -80 -1488 -80
WIRE -1136 -80 -1328 -80
WIRE -720 -80 -752 -80
WIRE -2416 -64 -2592 -64
WIRE -2160 -64 -2416 -64
WIRE -1952 -64 -2064 -64
WIRE -1632 -64 -1952 -64
WIRE -1488 -64 -1488 -80
WIRE -1488 -64 -1504 -64
WIRE -1632 -48 -1648 -48
WIRE -1328 -48 -1504 -48
WIRE -1136 -48 -1328 -48
WIRE -720 -48 -752 -48
WIRE -2400 -32 -2592 -32
WIRE -2160 -32 -2400 -32
WIRE -1952 -32 -2064 -32
WIRE -1648 -32 -1648 -48
WIRE -1648 -32 -1952 -32
WIRE -1488 -32 -1504 -32
WIRE 240 -32 240 -48
WIRE 352 -32 352 -64
WIRE 352 -32 240 -32
WIRE 512 -32 512 -48
WIRE 624 -32 624 -64
WIRE 624 -32 512 -32
WIRE 784 -32 784 -48
WIRE 896 -32 896 -64
WIRE 896 -32 784 -32
WIRE -1488 -16 -1488 -32
WIRE -1328 -16 -1488 -16
WIRE -1136 -16 -1328 -16
WIRE -720 -16 -752 -16
WIRE 1024 -16 1008 -16
WIRE 240 0 240 -32
WIRE 992 0 240 0
WIRE 1104 0 1056 0
WIRE 1152 0 1104 0
WIRE 1328 0 1280 0
WIRE 1376 0 1328 0
WIRE 1520 0 1456 0
WIRE -720 16 -752 16
WIRE -32 16 -32 -192
WIRE 1024 32 1008 32
WIRE -2112 48 -2112 16
WIRE -2112 48 -2160 48
WIRE -720 48 -752 48
WIRE 512 48 512 -32
WIRE 992 48 512 48
WIRE 1104 48 1056 48
WIRE 1152 48 1104 48
WIRE -1568 64 -1568 48
WIRE -1568 64 -1600 64
WIRE -1136 80 -1168 80
WIRE -720 80 -752 80
WIRE 1024 80 1008 80
WIRE 784 96 784 -32
WIRE 992 96 784 96
WIRE 1104 96 1056 96
WIRE 1152 96 1104 96
WIRE 1328 96 1280 96
WIRE 1520 96 1520 80
WIRE 1520 96 1328 96
WIRE 240 128 240 0
WIRE 352 128 240 128
WIRE 512 128 512 48
WIRE 624 128 512 128
WIRE 784 128 784 96
WIRE 896 128 784 128
WIRE 240 160 240 128
WIRE 352 160 352 128
WIRE 512 160 512 128
WIRE 624 160 624 128
WIRE 784 160 784 128
WIRE 896 160 896 128
WIRE 240 256 240 240
WIRE 352 256 352 224
WIRE 352 256 240 256
WIRE 512 256 512 240
WIRE 624 256 624 224
WIRE 624 256 512 256
WIRE 784 256 784 240
WIRE 896 256 896 224
WIRE 896 256 784 256
WIRE -32 288 -32 96
WIRE 240 288 240 256
WIRE 240 288 -32 288
WIRE 512 288 512 256
WIRE 512 288 240 288
WIRE 784 288 784 256
WIRE 784 288 512 288
WIRE -32 304 -32 288
FLAG 192 -112 UP
FLAG 192 -64 0
FLAG 464 -64 0
FLAG 736 -64 0
FLAG 736 224 0
FLAG 464 224 0
FLAG 192 224 0
FLAG 192 176 UN
FLAG 464 176 VN
FLAG 736 176 WN
FLAG 464 -112 VP
FLAG 736 -112 WP
FLAG -32 -192 V_DC
FLAG -720 -80 UP
FLAG -720 -48 UN
FLAG -720 -16 VP
FLAG -720 16 VN
FLAG -720 48 WP
FLAG -720 80 WN
FLAG -32 304 0
FLAG 1104 0 Vm_u
FLAG 1104 48 Vm_v
FLAG 1104 96 Vm_w
FLAG 1328 0 Vm+
FLAG 1328 96 Vm-
FLAG 2320 272 0
FLAG 2320 192 w_motor
FLAG 2160 -352 w_motor
FLAG 2240 -304 estimated_stator_angle
FLAG -2720 -464 estimated_stator_angle
FLAG -2560 -576 current_feedback_d
FLAG -2560 -560 current_feedback_q
FLAG 2096 -208 0
FLAG -2112 -336 quadrature_current_reference
FLAG -3136 16 quadrature_current_reference
FLAG -3136 48 current_feedback_q
FLAG -2400 -32 voltage_reference_quadrature
FLAG -3136 -64 direct_current_reference
FLAG -3136 -32 current_feedback_d
FLAG -2416 -64 voltage_reference_direct
FLAG -1600 64 estimated_stator_angle
FLAG -1328 -80 voltage_reference_u
FLAG -1328 -48 voltage_reference_v
FLAG -1328 -16 voltage_reference_w
FLAG -1168 80 V_DC
FLAG 1008 -16 i_m_u
FLAG 1008 32 i_m_v
FLAG 1008 80 i_m_w
FLAG -3008 -592 i_m_u
FLAG -3008 -560 i_m_v
FLAG -3008 -528 i_m_w
FLAG -1952 -64 v_ref_d_lim
FLAG -1952 -32 v_ref_q_lim
FLAG -2640 -336 throttle
SYMBOL InductionMotor 1280 48 R0
WINDOW 123 -128 108 Left 2
SYMATTR Value2 Ll1={L_motorl1} Ll2={L_motorl2} Dm={D_motor} Jm={J_motor} Np={N_poles_motor}
SYMATTR InstName U2
SYMATTR Value R1={R_motor1} R2={R_motor2} M={L_motorm}
SYMBOL sw 240 -32 M180
SYMATTR InstName S1
SYMBOL diode 368 -64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL sw 240 256 M180
SYMATTR InstName S2
SYMBOL diode 368 224 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL sw 512 -32 M180
SYMATTR InstName S3
SYMBOL diode 640 -64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL sw 512 256 M180
SYMATTR InstName S4
SYMBOL diode 640 224 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL sw 784 -32 M180
SYMATTR InstName S5
SYMBOL diode 912 -64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL sw 784 256 M180
SYMATTR InstName S6
SYMBOL diode 912 224 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL voltage -32 0 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 600
SYMBOL h 2320 176 R0
SYMATTR InstName H1
SYMATTR Value w_motor_i
SYMATTR Value2 1
SYMBOL Integral 2192 -272 R0
SYMATTR Value T=-1
SYMATTR InstName U19
SYMBOL voltage 1360 0 R270
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName w_motor_i
SYMATTR Value 0
SYMBOL voltage 2096 -304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 377
SYMBOL res 1504 -16 R0
SYMATTR InstName R1
SYMATTR Value .25
SYMBOL current_regulator -2864 -48 R0
WINDOW 39 0 0 Left 0
SYMATTR SpiceLine Kp=1 Ki=10000
SYMATTR InstName X3
SYMBOL park_transformation -2624 -544 R0
SYMATTR InstName X1
SYMBOL two_level_sine_modulator -944 -64 R0
SYMATTR InstName X2
SYMBOL CurrentSensor 1024 0 M180
SYMATTR InstName U1
SYMBOL CurrentSensor 1024 48 M180
SYMATTR InstName U3
SYMBOL CurrentSensor 1024 96 M180
SYMATTR InstName U4
SYMBOL pic32_three_phase_current_sampler -2832 -560 R0
SYMATTR InstName X4
SYMBOL inverse_park_transformation -1568 -32 R0
SYMATTR InstName X5
SYMBOL xy_limit -2160 -112 R0
SYMATTR InstName U5
SYMBOL Constant -2224 48 R0
SYMATTR Value K=100
SYMATTR InstName U6
SYMBOL pic32_throttle_sampler -2864 -336 R0
SYMATTR InstName X6
SYMBOL Constant -3120 -336 R0
SYMATTR Value K=5
SYMATTR InstName U7
SYMBOL torque_controller -2352 -336 R0
SYMATTR InstName X7
TEXT -248 -568 Left 2 !.tran 200m startup
TEXT 96 -408 Left 2 !.model SW SW(Ron=1 Roff=1Meg Vt=0.5)
TEXT 96 -376 Left 2 !.model D D(Ron=.1 Roff=1Meg Vfwd=.4)
TEXT 1248 -424 Left 2 !.param R_motor1=1\n.param R_motor2=1\n.param L_motorm=0.1\n.param L_motorl1=1m\n.param L_motorl2=1m\n.param D_motor=10m\n.param J_motor=10m\n.param N_poles_motor=2
